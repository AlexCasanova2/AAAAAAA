import{A as D}from"./AppHeader-B-6ciBPX.js";import{r as c,j as N,a as i,f as k,b as t,w as C,h as G,d as U,t as g,s as v,o as d,z as $,k as h,q as V,i as E,F as T,m as I,u as z,x as M}from"./index-DGUlPAX8.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as A,A as B}from"./arrow-left-7li7JSlN.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=A("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),S={key:0,class:"fixed inset-0 bg-[var(--color-dark-background)]/80 flex justify-center items-center z-50 p-4 modal-fade-in"},q={class:"bg-[var(--color-dark-background-lighter)] rounded-2xl p-6 w-full max-w-sm flex flex-col space-y-6 text-[#fefefe]"},F={class:"space-y-4"},H={key:0,class:"text-red-500 text-sm mt-1"},P={class:"flex space-x-4"},R=["disabled"],J={__name:"CreateGroupModal",props:{modelValue:Boolean},emits:["update:modelValue","groupCreated"],setup(x,{emit:b}){const m=x,p=b,a=c(""),u=c(""),n=c(!1),s=c(""),f=()=>{p("update:modelValue",!1),a.value="",u.value="",n.value=!1,s.value=""},_=()=>{s.value=""},w=async()=>{if(a.value.trim()){n.value=!0,s.value="";try{const{data:{user:o}}=await v.auth.getUser();if(!o)throw new Error("Usuario no autenticado");const{data:e,error:r}=await v.from("groups").insert({name:a.value.trim(),description:u.value.trim()||null,created_by:o.id}).select();if(r)throw console.error("Error al crear el grupo:",r),r;const l=e[0],{error:y}=await v.from("group_members").insert({group_id:l.id,user_id:o.id,role:"admin"});if(y)throw console.error("Error al añadir creador como miembro:",y),y;p("groupCreated",l),f()}catch(o){console.error("Error en el proceso de creación de grupo:",o.message),s.value=`Error al crear el grupo: ${o.message}`}finally{n.value=!1}}};return N(()=>m.modelValue,o=>{o||(a.value="",u.value="",n.value=!1,s.value="")}),(o,e)=>x.modelValue?(d(),i("div",S,[t("div",q,[e[4]||(e[4]=t("h2",{class:"text-xl font-medium text-center"},"Crear nuevo grupo",-1)),t("div",F,[t("div",null,[e[2]||(e[2]=t("label",{for:"groupName",class:"block text-sm font-medium mb-2"},"Nombre del grupo",-1)),C(t("input",{type:"text",id:"groupName","onUpdate:modelValue":e[0]||(e[0]=r=>a.value=r),class:U(["w-full px-4 py-2 rounded-lg bg-white/10 border border-white/10 focus:border-white focus:outline-none transition-colors text-[#fefefe]",{"border-red-500":s.value}]),placeholder:"Mi grupo de gritos",onInput:_},null,34),[[G,a.value]]),s.value?(d(),i("p",H,g(s.value),1)):k("",!0)]),t("div",null,[e[3]||(e[3]=t("label",{for:"groupDescription",class:"block text-sm font-medium mb-2"},"Descripción (opcional)",-1)),C(t("textarea",{id:"groupDescription","onUpdate:modelValue":e[1]||(e[1]=r=>u.value=r),rows:"3",class:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/10 focus:border-white focus:outline-none transition-colors resize-none text-[#fefefe]",placeholder:"Un grupo para compartir gritos..."},null,512),[[G,u.value]])])]),t("div",P,[t("button",{onClick:f,class:"flex-1 bg-[var(--color-dark-background-light)] border border-white/10 text-[#fefefe] rounded-lg py-3 font-medium hover:bg-[var(--color-dark-background-lighter)] transition-colors duration-200"}," Cancelar "),t("button",{onClick:w,disabled:!a.value.trim()||n.value,class:"flex-1 bg-red-500 text-white rounded-lg py-3 font-medium hover:bg-red-600 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},g(n.value?"Creando...":"Crear"),9,R)])])])):k("",!0)}},K=j(J,[["__scopeId","data-v-10ba862e"]]),O={class:"h-[100dvh] bg-[var(--color-dark-background)] text-white flex flex-col"},Q={class:"flex-1 p-4",style:{paddingTop:"calc(4rem + env(safe-area-inset-top))"}},W={key:0,class:"flex justify-center items-center h-full"},X={key:1,class:"flex justify-center items-center h-full"},Y={key:2,class:"space-y-4"},Z=["onClick"],ee={class:"font-semibold text-xl mb-1"},oe={class:"text-gray-300 text-sm mb-3"},re={class:"text-gray-400 text-xs"},te={__name:"GroupsView",setup(x){const b=z(),m=c(!1),p=c([]),a=c(!0),u=()=>{b.push("/")},n=()=>{m.value=!0},s=o=>{console.log("Nuevo grupo creado:",o),f()},f=async()=>{a.value=!0;try{const{data:{user:o}}=await v.auth.getUser();if(!o){console.error("Usuario no autenticado, no se pueden cargar los grupos."),a.value=!1;return}const{data:e,error:r}=await v.from("group_members").select(`
        group_id,
        joined_at,
        groups (id, name, description, created_by)
      `).eq("user_id",o.id);if(r)throw console.error("Error al cargar miembros del grupo:",r),r;p.value=e.map(l=>({id:l.groups.id,name:l.groups.name,description:l.groups.description,created_by:l.groups.created_by,joined_at:l.joined_at,role:l.role}))}catch(o){console.error("Error cargando grupos del usuario:",o.message)}finally{a.value=!1}},_=o=>{const e=new Date(o),r={year:"numeric",month:"long",day:"numeric"};return e.toLocaleDateString("es-ES",r)},w=o=>{b.push({name:"group-detail",params:{id:o}})};return $(()=>{f()}),(o,e)=>(d(),i("div",O,[h(D,{title:"Mis Grupos","dark-mode":!0},{"left-content":V(()=>[t("button",{class:"p-1 flex items-center justify-center hover:opacity-80 transition-opacity","aria-label":"Tornar",onClick:u},[h(M(B),{class:"w-6 h-6 stroke-white"})])]),"right-content":V(()=>[t("button",{class:"p-1 flex items-center justify-center hover:opacity-80 transition-opacity","aria-label":"Crear Grupo",onClick:n},[h(M(L),{class:"w-6 h-6 stroke-white"})])]),_:1}),t("div",Q,[a.value?(d(),i("div",W,e[1]||(e[1]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"},null,-1)]))):p.value.length===0?(d(),i("div",X,e[2]||(e[2]=[t("p",{class:"text-white/70 text-center"},[E("No eres miembro de ningún grupo."),t("br"),E("¡Crea uno o únete a uno existente!")],-1)]))):(d(),i("div",Y,[(d(!0),i(T,null,I(p.value,r=>(d(),i("div",{key:r.id,class:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-lg p-5 transition-all duration-300 ease-in-out shadow-lg border border-white/10 animate-fade-in-up hover:scale-[1.01] hover:shadow-xl cursor-pointer",onClick:l=>w(r.id)},[t("h4",ee,g(r.name),1),t("p",oe,g(r.description||"Sin descripción"),1),t("p",re,"Miembro desde: "+g(_(r.joined_at)),1)],8,Z))),128))]))]),h(K,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=r=>m.value=r),onGroupCreated:s},null,8,["modelValue"])]))}},ie=j(te,[["__scopeId","data-v-41b06089"]]);export{ie as default};
